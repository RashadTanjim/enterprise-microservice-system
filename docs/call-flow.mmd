sequenceDiagram
  autonumber
  participant Client
  participant Gateway as Nginx Gateway
  participant UserSvc as User Service
  participant OrderSvc as Order Service
  participant RepoSvc as Repository Service
  participant Redis as Redis Cache
  participant UserDB as User DB
  participant OrderDB as Order DB
  participant RepoDB as Repository DB

  Client->>Gateway: POST /api/v1/auth/token
  Gateway->>UserSvc: Issue token
  UserSvc-->>Gateway: JWT
  Gateway-->>Client: JWT

  Client->>Gateway: GET /api/v1/users (Bearer)
  Gateway->>UserSvc: Forward request
  UserSvc->>Redis: Get user list
  Redis-->>UserSvc: Cache miss
  UserSvc->>UserDB: Query users
  UserDB-->>UserSvc: User list
  UserSvc->>Redis: Set user list
  UserSvc-->>Gateway: Users response
  Gateway-->>Client: Users response

  Client->>Gateway: POST /api/v1/orders (Bearer)
  Gateway->>OrderSvc: Forward request
  OrderSvc->>UserSvc: Validate user (service token)
  UserSvc-->>OrderSvc: User info
  OrderSvc->>OrderDB: Create order
  OrderDB-->>OrderSvc: Order created
  OrderSvc->>Redis: Update order cache
  OrderSvc-->>Gateway: Order response
  Gateway-->>Client: Order response

  Client->>Gateway: GET /api/v1/repositories (Bearer)
  Gateway->>RepoSvc: Forward request
  RepoSvc->>Redis: Get repository list
  Redis-->>RepoSvc: Cache hit
  RepoSvc-->>Gateway: Repository list
  Gateway-->>Client: Repository list
